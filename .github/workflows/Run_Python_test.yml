name: Run_Python_test
on:
  push:
    branches: [main]

jobs:
  job1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
      - uses: jannekem/run-python-script-action@v1
      
        with:
          script: |

            path = 'https://docs.cognite.com'
            path1 = ''
            import re
            message = str("""${{github.event.head_commit.message}}""").replace("\n\n", "##").replace("\n", "@")
            reg_result = re.search('##(.*)', message)
            
            commit_description = reg_result.group(1)
            description_arr = commit_description.split("@")
            print(description_arr)

            for file_url in description_arr:
              print("file_url"+file_url)
              search_text  = ".md"      
              reg_match = str(re.search('docs(.*).md', file_url).group(1))  
              
              if reg_match != "": 
                generated_path = path+reg_match
                path1 = path1+'\n'+generated_path
                print("generated_path:"+generated_path)
                set_env("path1", path1)

      - uses: pullreminders/slack-action@master
        if: contains(github.event.head_commit.message, 'kp')
      
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
              
        with:
           args: '{\"channel\":\"C03LV8M6P25\",\"text\":\" Following files have been changed by ${{github.event.commits[0].author.username}}: \n ${{env.path1}}  \"}'  
   
 
  job2:
    needs: job1
  # The type of runner that the job will run on
    runs-on: ubuntu-latest

  # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Notify slack changeCompare
      if: contains(github.event.head_commit.message, 'kp')
      
      env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          
          
      uses: pullreminders/slack-action@master
      with:
        args: '{\"channel\":\"C03LV8M6P25\",\"text\":\" Following changes have been done by ${{github.event.commits[0].author.username}}:  \n Please follow the link for change comparison : ${{github.event.compare}} \"}'  
